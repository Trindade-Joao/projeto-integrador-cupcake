<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base}">
<head>
    <title>Seu Carrinho</title>
</head>
<body>
<div layout:fragment="content">
    <h1 class="mb-4 text-center">Seu Carrinho</h1>

    <div th:if="${sucesso}" class="alert alert-success" role="alert" th:text="${sucesso}"></div>
    <div th:if="${erro}" class="alert alert-danger" role="alert" th:text="${erro}"></div>

    <div class="row">

        <div class="col-md-8">
            <div class="card p-4 h-100">
                <h3 class="card-title mb-4">Itens no Carrinho</h3>

                <div th:if="${carrinho.itens.isEmpty()}" class="text-center p-5">
                    <p class="lead">Seu carrinho est√° vazio. üôÅ</p>
                    <a th:href="@{/vitrine}" class="btn btn-primary mt-3">Voltar √† Vitrine</a>
                </div>

                <table th:unless="${carrinho.itens.isEmpty()}" class="table table-dark table-striped">
                    <thead>
                    <tr>
                        <th>Produto</th>
                        <th class="text-end">Pre√ßo Unit.</th>
                        <th class="text-center">Quantidade</th>
                        <th class="text-end">Subtotal</th>
                        <th>A√ß√µes</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="entry : ${carrinho.itens}">
                        <td>
                            <img src="https://via.placeholder.com/50x50?text=C" alt="Produto" class="me-2 rounded">
                            <span th:text="${entry.key.nome}"></span>
                        </td>
                        <td class="text-end" th:text="'R$ ' + ${#numbers.formatDecimal(entry.key.preco, 1, 'POINT', 2, 'COMMA')}"></td>
                        <td class="text-center">
                            <span th:text="${entry.value}"></span>
                        </td>
                        <td class="text-end fw-bold" th:with="subtotalItem=${entry.key.preco.multiply(new java.math.BigDecimal(entry.value))}">
                            <span th:text="'R$ ' + ${#numbers.formatDecimal(subtotalItem, 1, 'POINT', 2, 'COMMA')}"></span>
                        </td>
                        <td>
                            <a th:href="@{/carrinho/remover/{id}(id=${entry.key.produtoKey})}" class="btn btn-sm btn-danger">Remover</a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card p-4 bg-secondary-subtle">
                <h3 class="card-title text-light">Resumo do Pedido</h3>

                <div class="d-flex justify-content-between mb-1">
                    <span>Subtotal:</span>
                    <span th:text="'R$ ' + ${#numbers.formatDecimal(carrinho.calcularSubtotal(), 1, 'POINT', 2, 'COMMA')}"></span>
                </div>
                <div class="d-flex justify-content-between border-bottom pb-2 mb-2">
                    <span>Frete:</span>
                    <span th:text="'R$ ' + ${#numbers.formatDecimal(carrinho.getValorFrete(), 1, 'POINT', 2, 'COMMA')}"></span>
                </div>

                <div class="d-flex justify-content-between fs-5 fw-bold mb-4">
                    <span>TOTAL:</span>
                    <span th:text="'R$ ' + ${#numbers.formatDecimal(carrinho.calcularTotal(), 1, 'POINT', 2, 'COMMA')}" class="text-primary"></span>
                </div>

                <a th:href="@{/checkout}" class="btn btn-primary w-100 mb-2" th:classappend="${carrinho.itens.isEmpty()} ? 'disabled'">
                    Prosseguir para Pagamento
                </a>

                <a th:href="@{/carrinho/limpar}"
                   th:class="${carrinho.itens.isEmpty()} ? 'd-none' : 'btn btn-secondary w-100'"
                   onclick="return confirm('Deseja cancelar a compra e remover os itens?')"
                   style="background-color: #f1a362; border-color: #f1a362;">
                    Cancelar Compra
                </a>
            </div>
        </div>
    </div>
</div>
</body>
</html>